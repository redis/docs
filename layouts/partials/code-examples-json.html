{{- /* Extract code examples from the page content */ -}}
{{- /* This partial finds all code example anchors and builds a JSON structure */ -}}
{{- /* Input: page object with .Content */ -}}
{{- /* Output: JSON array of code examples */ -}}

{{- $content := .Content -}}

{{- /* Extract all anchor IDs and descriptions */ -}}
{{- $examples := slice -}}

{{- /* Use regex to find all <a id="..."></a> anchors with optional data-description */ -}}
{{- $matches := findRE `<a id="([^"]+)"[^>]*(?:data-description="([^"]*)")?[^>]*></a>` $content -}}

{{- range $match := $matches -}}
  {{- /* Extract the ID from the match */ -}}
  {{- $id := replaceRE `<a id="([^"]+)".*` `$1` $match -}}

  {{- /* Extract the description if it exists */ -}}
  {{- $description := "" -}}
  {{- if findRE `data-description="([^"]*)"` $match -}}
    {{- $description = replaceRE `.*data-description="([^"]*)".*` `$1` $match -}}
  {{- end -}}

  {{- /* Create example object with the ID and optional description */ -}}
  {{- $example := dict "id" $id -}}
  {{- if $description -}}
    {{- $example = merge $example (dict "description" $description) -}}
  {{- end -}}
  {{- $examples = $examples | append $example -}}
{{- end -}}

{{- /* Return as JSON array */ -}}
{{- if gt (len $examples) 0 -}}
  {{- $examples | jsonify -}}
{{- else -}}
  {{- "[]" -}}
{{- end -}}

