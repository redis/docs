{{ define "head" }}
  <script src='{{ relURL "js/commands-filters.js" }}' defer></script>
{{ end }}

{{ define "main" }}
  {{ partial "path-scratch.html" }}
  <main class="docs w-full max-w-[1920px] mx-auto px-5 flex flex-col md:flex-row">
    {{ partial "docs-nav-collapsed.html" . }}
    <div class="w-full py-12 md:px-4 xl:px-16">
      {{ partial "breadcrumbs" . }}
      <section class="prose w-full py-12"> 
        <h1>Commands</h1>
      </section>
      {{/* Filter controls - sticky below header */}}
      <div class="sticky top-[70px] z-40 bg-white pt-4 pb-4 -mx-5 px-5 md:-mx-4 md:px-4 xl:-mx-16 xl:px-16 border-b border-redis-pen-800/20 shadow-sm">
        <form id="command-filter" class="flex flex-col gap-4 mb-4">
        <label class="relative flex items-center">
          <span class="sr-only">Search commands&hellip;</span>
          <svg class="text-redis-ink-900 absolute left-4 w-5 h-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
            <circle cx="10" cy="10" r="7" />
            <line x1="21" y1="21" x2="15" y2="15" />
          </svg>
          <input class="transition appearance-none block w-full pl-12 pr-4 py-3 rounded-md bg-clip-padding bg-white hover:bg-red-50/50 focus:bg-red-50/50 border border-redis-ink-900 ring-red-200 focus:ring-red-200 focus:ring-[3px] focus:outline-none text-redis-ink-900 placeholder:text-redis-ink-900/70" id="name-filter" type="search" autocapitalize="off" autocomplete="off" autocorrect="off" placeholder="Search commands&hellip;" spellcheck="false">
        </label>

        <div class="flex flex-col sm:flex-row gap-4">
          {{/* Redis version filter */}}
          <label class="flex-1">
            <span class="block text-sm font-medium text-redis-ink-900 mb-2">Redis version</span>
            <select id="version-filter" class="transition appearance-none block w-full px-4 py-3 rounded-md bg-white hover:bg-red-50/50 focus:bg-red-50/50 border border-redis-ink-900 ring-red-200 focus:ring-red-200 focus:ring-[3px] focus:outline-none text-redis-ink-900">
              <option value="">All versions</option>
              <option value="8.0">Redis 8.0+</option>
              <option value="7.4">Redis 7.4+</option>
              <option value="7.2">Redis 7.2+</option>
              <option value="7.0">Redis 7.0+</option>
              <option value="6.2">Redis 6.2+</option>
              <option value="6.0">Redis 6.0+</option>
              <option value="5.0">Redis 5.0+</option>
              <option value="4.0">Redis 4.0+</option>
              <option value="3.2">Redis 3.2+</option>
              <option value="3.0">Redis 3.0+</option>
              <option value="2.8">Redis 2.8+</option>
              <option value="2.6">Redis 2.6+</option>
            </select>
          </label>

          {{/* Deprecated filter */}}
          <label class="flex-1">
            <span class="block text-sm font-medium text-redis-ink-900 mb-2">Deprecated commands</span>
            <select id="deprecated-filter" class="transition appearance-none block w-full px-4 py-3 rounded-md bg-white hover:bg-red-50/50 focus:bg-red-50/50 border border-redis-ink-900 ring-red-200 focus:ring-red-200 focus:ring-[3px] focus:outline-none text-redis-ink-900">
              <option value="show">Show all</option>
              <option value="hide">Hide deprecated</option>
              <option value="only">Only deprecated</option>
            </select>
          </label>
        </div>
        </form>

        {{/* Results count */}}
        <div id="commands-count" class="text-sm text-redis-ink-900/70 mt-2">
          <span id="count-text"></span>
        </div>
      </div>

      {{/* No results message */}}
      <div id="no-results" class="hidden text-center py-12 text-redis-ink-900/70">
        <svg class="mx-auto h-12 w-12 text-redis-ink-900/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        <h3 class="mt-2 text-lg font-medium">No commands found</h3>
        <p class="mt-1">Try adjusting your search or filter criteria.</p>
      </div>

      {{/* Group commands by their group field */}}
      {{ $pages := (where .Site.Pages "Section" .Section).ByWeight }}
      {{ $pages = (where $pages ".Params.hidden" "!=" true) }}
      {{ $scratch := newScratch }}
      {{ range $pages }}
        {{ $group := .Params.group }}
        {{ if $group }}
          {{ $existing := $scratch.Get $group }}
          {{ if $existing }}
            {{ $scratch.Set $group ($existing | append .) }}
          {{ else }}
            {{ $scratch.Set $group (slice .) }}
          {{ end }}
        {{ end }}
      {{ end }}

      {{/* Sort groups alphabetically */}}
      {{ $groupsData := index .Site.Data "command-groups" }}
      {{ $sortedGroups := slice }}
      {{ range $groupId, $groupInfo := $groupsData }}
        {{ $commands := $scratch.Get $groupId }}
        {{ if $commands }}
          {{ $sortedGroups = $sortedGroups | append (dict "id" $groupId "info" $groupInfo "commands" $commands) }}
        {{ end }}
      {{ end }}
      {{ $sortedGroups = sort $sortedGroups "info.display" }}

      {{/* Render accordion groups */}}
      <div id="commands-accordion" class="flex flex-col gap-2">
        {{ range $sortedGroups }}
          {{ $groupId := .id }}
          {{ $groupInfo := .info }}
          {{ $commands := .commands }}
          {{ $commandCount := len $commands }}

          <div class="command-group border border-redis-pen-800 rounded-md bg-white" data-group="{{ $groupId }}">
            {{/* Group header - clickable to expand/collapse */}}
            <button
              type="button"
              class="group-header w-full flex items-start gap-3 px-6 py-4 text-left hover:bg-red-50/50 transition-colors rounded-md"
              data-group-id="{{ $groupId }}"
              aria-expanded="false"
            >
              <svg class="group-chevron w-5 h-5 text-redis-ink-900 transition-transform duration-200 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
              <div class="flex-1">
                <h2 class="text-xl font-semibold text-redis-ink-900">
                  {{ $groupInfo.display }}
                  <span class="group-count ml-2 text-sm font-normal text-redis-ink-900/60">({{ $commandCount }} commands)</span>
                </h2>
                <p class="text-sm text-redis-ink-900/70 mt-1">{{ $groupInfo.description }}</p>
              </div>
            </button>

            {{/* Group content - commands list */}}
            <div class="group-content hidden border-t border-redis-pen-800">
              <div class="px-6 py-4">
                {{ range sort $commands "Title" }}
                  <div
                    class="command-item py-3 border-b border-redis-pen-800/30 last:border-b-0"
                    data-name="{{ .Title }}"
                    data-group="{{ .Params.group }}"
                    data-since="{{ .Params.since }}"
                    {{ if in .Params.doc_flags "deprecated" }}data-deprecated="true"{{ end }}
                  >
                    <div class="flex items-center gap-2 mb-1">
                      <a
                        href="{{ .RelPermalink }}"
                        class="font-mono font-medium text-base text-redis-ink-900 hover:text-redis-red-500 transition-colors"
                      >
                        {{ .Title }}
                      </a>
                      {{ if in .Params.doc_flags "deprecated" }}
                        <span class="deprecated-badge">Deprecated</span>
                      {{ end }}
                    </div>
                    <p class="text-sm text-redis-ink-900/70 ml-0">{{ .Summary }}</p>
                  </div>
                {{ end }}
              </div>
            </div>
          </div>
        {{ end }}
      </div>
    </div>

    {{/* Right sidebar - only Edit/Issue links */}}
    <div class="hidden md:block w-64 shrink-0 py-6">
      <section class="fixed pt-6 flex flex-col gap-4 w-64">
        <a href="https://github.com/redis/docs/edit/latest/content/commands/_index.md" class="text-sm text-redis-ink-900 hover:text-redis-red-500 transition-colors flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
          </svg>
          Edit this page
        </a>
        <a href="https://github.com/redis/docs/issues/new" class="text-sm text-redis-ink-900 hover:text-redis-red-500 transition-colors flex items-center gap-2">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          Create an issue
        </a>
      </section>
    </div>
    {{ partial "scripts.html" . }}
  </main>
{{ end }}
