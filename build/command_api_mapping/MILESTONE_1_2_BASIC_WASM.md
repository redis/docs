# Milestone 1.2: Basic WASM Module & Node.js Integration\n\n## Objective\n\nCreate a simple Rust WASM function and verify it can be called from Node.js. This validates the Rust-to-WASM-to-Node.js pipeline works correctly.\n\n## Prerequisites\n\n- Completed Milestone 1.1 (Project Setup)\n- Rust project builds successfully\n- Node.js project builds successfully\n- wasm-pack installed\n\n## Tasks\n\n### 1. Create Simple Rust WASM Function\n\n- [ ] Open `rust/src/lib.rs`\n- [ ] Add `wasm-bindgen` import: `use wasm_bindgen::prelude::*;`\n- [ ] Create a simple test function:\n  ```rust\n  #[wasm_bindgen]\n  pub fn add(a: i32, b: i32) -> i32 {\n      a + b\n  }\n  ```\n- [ ] Create another test function that returns a string:\n  ```rust\n  #[wasm_bindgen]\n  pub fn greet(name: &str) -> String {\n      format!(\"Hello, {}!\", name)\n  }\n  ```\n- [ ] Verify Rust code compiles: `cd rust && cargo build`\n\n### 2. Build WASM Module\n\n- [ ] From `rust/` directory, run: `wasm-pack build --target nodejs`\n- [ ] Verify WASM binary is generated in `wasm/pkg/`\n- [ ] Check that the following files exist:\n  - `wasm/pkg/redis_parser.js` (or similar name)\n  - `wasm/pkg/redis_parser_bg.wasm`\n  - `wasm/pkg/redis_parser.d.ts`\n  - `wasm/pkg/package.json`\n\n### 3. Create Node.js Wrapper\n\n- [ ] Create `node/src/wasm-wrapper.ts`:\n  ```typescript\n  import * as wasmModule from '../wasm/pkg/redis_parser.js';\n  \n  export function callAdd(a: number, b: number): number {\n    return wasmModule.add(a, b);\n  }\n  \n  export function callGreet(name: string): string {\n    return wasmModule.greet(name);\n  }\n  ```\n- [ ] Verify TypeScript compiles: `cd node && npm run build`\n\n### 4. Create Test Script\n\n- [ ] Create `node/src/test-wasm.ts`:\n  ```typescript\n  import { callAdd, callGreet } from './wasm-wrapper';\n  \n  console.log('Testing WASM functions...');\n  console.log('add(5, 3) =', callAdd(5, 3));\n  console.log('greet(\"World\") =', callGreet('World'));\n  console.log('All tests passed!');\n  ```\n- [ ] Add test script to `node/package.json`:\n  ```json\n  \"scripts\": {\n    \"test-wasm\": \"tsx src/test-wasm.ts\"\n  }\n  ```\n\n### 5. Test WASM Integration\n\n- [ ] From `node/` directory, run: `npm run test-wasm`\n- [ ] Verify output shows:\n  - `add(5, 3) = 8`\n  - `greet(\"World\") = Hello, World!`\n  - `All tests passed!`\n- [ ] If errors occur, debug and fix\n\n### 6. Create Integration Test\n\n- [ ] Create `node/src/integration-test.ts` that:\n  - Tests multiple WASM function calls\n  - Tests error handling\n  - Tests with various input types\n- [ ] Add to `node/package.json`:\n  ```json\n  \"test\": \"tsx src/integration-test.ts\"\n  ```\n- [ ] Run: `npm test`\n- [ ] Verify all tests pass\n\n### 7. Document WASM Integration\n\n- [ ] Update `DEVELOPMENT.md` with:\n  - How to build WASM module\n  - How to call WASM from Node.js\n  - Common WASM issues and solutions\n  - Performance considerations\n- [ ] Create `node/src/README.md` explaining:\n  - WASM wrapper pattern\n  - How to add new WASM functions\n  - Testing WASM functions\n\n## Deliverables\n\n✅ **Simple Rust WASM functions** (add, greet)\n✅ **WASM binary** compiled and ready to use\n✅ **Node.js wrapper** to call WASM functions\n✅ **Test script** that verifies WASM works\n✅ **Integration tests** for WASM functions\n✅ **Documentation** for WASM integration\n\n## Project Structure After Completion\n\n```\nbuild/command_api_mapping/mcp-server/\n├── rust/\n│   ├── Cargo.toml\n│   └── src/\n│       └── lib.rs                  # Contains add() and greet()\n├── node/\n│   ├── package.json\n│   ├── src/\n│   │   ├── index.ts\n│   │   ├── wasm-wrapper.ts         # NEW\n│   │   ├── test-wasm.ts            # NEW\n│   │   ├── integration-test.ts      # NEW\n│   │   └── README.md               # NEW\n│   └── dist/\n├── wasm/\n│   └── pkg/                        # Generated WASM\n└── DEVELOPMENT.md                  # Updated\n```\n\n## Success Criteria\n\n- [ ] Rust WASM functions compile without errors\n- [ ] WASM binary is generated successfully\n- [ ] Node.js can import and call WASM functions\n- [ ] Test script runs and produces correct output\n- [ ] Integration tests pass\n- [ ] No TypeScript errors\n- [ ] Documentation is clear\n\n## Common Issues & Solutions\n\n**Issue**: WASM module not found\n- **Solution**: Verify `wasm-pack build` was run and files exist in `wasm/pkg/`\n\n**Issue**: TypeScript can't find WASM types\n- **Solution**: Verify `wasm/pkg/redis_parser.d.ts` exists and is imported correctly\n\n**Issue**: WASM function returns wrong type\n- **Solution**: Check `#[wasm_bindgen]` attribute and Rust function signature\n\n## Notes\n\n- Keep WASM functions simple for now (just testing the pipeline)\n- Document any deviations from this plan\n- If WASM integration fails, debug thoroughly before moving on\n\n## When Complete\n\n1. Verify all success criteria are met\n2. Run `npm test` and confirm all tests pass\n3. Return to `IMPLEMENTATION_PLAN.md`\n4. Check off this milestone: `- [x] **Milestone 1.2**: Basic WASM Module & Node.js Integration`\n5. Update status to \"Complete\"\n6. Move to **Milestone 1.3**: MCP Server Skeleton\n"
